/**
* First attempt to provide some native functionality to deskshell applications (windows)
*/

fs = require("fs");
var exec = require('child_process').exec;
	
module.exports.filePicker = function(params, back) {
	var out = __dirname+'\\out.'+Math.random().toString().substring(3)+'.txt';
	var opt = " /fn filePicker";
	opt += " /out "+out
	if(params.opensave) opt+= " /opensave "+params.opensave;
	if(params.folder) opt+= " /folder '"+params.folder+"'";
	if(params.filter) opt+= " /filter '"+params.filter+"'";
	console.log("winfunc.exe"+opt);
	fpicker = exec(__dirname+'\\winfunc.exe'+opt);

	fpicker.on('close', function (code) {
	  	fs.readFile(out, 'utf8', function(err, data) {
			if (err) throw err;
			fs.unlink(out);
			back(data);
		});
	});
}
module.exports.folderPicker = function(params, back) {
	var out = __dirname+'\\out.'+Math.random().toString().substring(3)+'.txt';
	var opt = " /fn folderPicker";
	opt += " /out "+out
	if(params.folder) opt+= " /folder '"+params.folder+"'";
	if(params.title) opt+= " /title '"+params.title+"'";
	console.log("winfunc.exe"+opt);
	fpicker = exec(__dirname+'\\winfunc.exe'+opt);

	fpicker.on('close', function (code) {
	  	fs.readFile(out, 'utf8', function(err, data) {
			if (err) throw err;
			fs.unlink(out);
			back(data);
		});
	});
}